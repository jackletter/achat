<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <link href="js/layui-v2.4.5/css/layui.css" rel="stylesheet" />
    <link href="css/animate.css" rel="stylesheet" />
    <link href="css/chat.css" rel="stylesheet" />

    <script src="js/jquery-2.0.3.js"></script>
    <script src="js/layui-v2.4.5/layui.all.js"></script>
    <script src="js/chat.js"></script>
    <!--<script src="js/test.js"></script>-->
    <title>聊天室</title>
</head>
<body>
    <!--登录窗口-->
    <div id="login" style="display:block">
        <div class="row">
            <span>用户名:</span>
            <input type="text" id="username" value="test1" />
        </div>
        <div class="row">
            <span>密&nbsp;&nbsp;&nbsp;&nbsp;码:</span>
            <input type="password" id="password" value="1" />
        </div>
        <div class="row bottom">
            <button class="layui-btn layui-btn-normal" style="width:100%;" onclick="login()">登录</button>
            <a href="register.html">注册</a>
            <a href="forgetpwd.html">忘记密码</a>
        </div>
    </div>
    <!--主面板-->
    <div id="userwin">
        <div class="win-header">
            <div class="win-title">
                <div class="title-text">
                    <img id="currUserImg" src="img/user1.png" />
                    <span id="currUserName">纸飞机</span>
                </div>
                <div class="title-desc">
                    <input type="text" id="currUserDesc" value="在深邃的编码世界，做一枚轻盈的纸飞机" />
                </div>
            </div>
            <div class="win-tabs">
                <div onclick="toggleTab(this)" data-kind="user">
                    <i class="layui-icon layui-icon-friends active" title="联系人"></i>
                </div>
                <div onclick="toggleTab(this)" data-kind="group">
                    <i class="layui-icon layui-icon-group" title="群组"></i>
                </div>
                <div onclick="toggleTab(this)" data-kind="history">
                    <i class="layui-icon layui-icon-reply-fill" title="历史会话"></i>
                </div>
            </div>
            <div class="win-close">
                <a href="javascript:void(0)" class="icon-close"></a>
            </div>
        </div>
        <div class="win-content">
            <div id="tabUser">
                <ul class="user-container"></ul>
            </div>
            <div id="tabGroup">
                <ul class="user-container"></ul>
            </div>
            <div id="tabHistory">
                <ul class="user-container"></ul>
            </div>
        </div>
        <div class="win-bottom">
            <div class="bottom-module" data-btn="search">
                <i class="layui-icon layui-icon-search" title="搜索"></i>
            </div>
            <div class="bottom-module" data-btn="msgbox">
                <i class="layui-icon layui-icon-speaker" title="消息盒子"></i>
                <span class="msg-count">0</span>
            </div>
            <div class="bottom-module" data-btn="adduser">
                <i class="layui-icon layui-icon-add-circle-fine" title="查找"></i>
            </div>
            <div class="bottom-module" data-btn="refresh">
                <i class="layui-icon layui-icon-refresh-1" title="刷新"></i>
            </div>
            <div class="bottom-module" data-btn="about">
                <i class="layui-icon layui-icon-about" title="关于"></i>
            </div>
        </div>
    </div>
    <!--个人聊天窗口-->
    <div class="talk-win talk-user for-clone">
        <div class="talk-header">
            <div class="talk-title">
                <img class="destUserImg" src="img/user1.png" />
                <span class="destUserName">贤心</span>
                <p class="destUserDesc">这个是测试的对话窗口</p>
            </div>
            <div class="talk-win-handle">
                <a href="javascript:void(0)" class="icon-min" title="最小化"><cite></cite></a>
                <a href="javascript:void(0)" class="icon-max" title="最大化"></a>
                <a href="javascript:void(0)" class="icon-close" title="关闭"></a>
            </div>
        </div>
        <div class="talk-content">
            <ul></ul>
        </div>
        <div class="talk-edit">
            <div class="talk-tool">
                <span title="选择表情">
                    <i class="layui-icon layui-icon-face-smile"></i>
                </span>
                <span title="发送图片">
                    <i class="layui-icon layui-icon-picture-fine"></i>
                </span>
                <span title="发送文件">
                    <i class="layui-icon layim-tool-image"></i>
                </span>
                <span title="发送网络音频">
                    <i class="layui-icon layui-icon-headset"></i>
                </span>
                <span title="发送网络视频">
                    <i class="layui-icon layui-icon-video"></i>
                </span>
                <span>
                    <i class="layui-icon layui-icon-log"></i>
                    <span>聊天记录</span>
                </span>
            </div>
            <div class="talk-text">
                <textarea></textarea>
            </div>
            <div class="talk-op">
                <div class="talk-btns">
                    <span class="talk-btns-close">关闭</span>
                    <span class="talk-btns-send">发送</span>
                </div>
            </div>
        </div>
    </div>
    <!--群组聊天窗口-->
    <div class="talk-win talk-group for-clone">
        <div class="talk-header">
            <div class="talk-title">
                <img class="destUserImg" src="img/user1.png" />
                <span class="destUserName">贤心</span>
                <p class="destUserDesc">这个是测试的对话窗口</p>
            </div>
            <div class="talk-win-handle">
                <a href="javascript:void(0)" class="icon-min" title="最小化"><cite></cite></a>
                <a href="javascript:void(0)" class="icon-max" title="最大化"></a>
                <a href="javascript:void(0)" class="icon-close" title="关闭"></a>
            </div>
        </div>
        <div class="talk-content">
            <ul></ul>
        </div>
        <div class="talk-edit">
            <div class="talk-tool">
                <span title="选择表情">
                    <i class="layui-icon layui-icon-face-smile"></i>
                </span>
                <span title="发送图片">
                    <i class="layui-icon layui-icon-picture-fine"></i>
                </span>
                <span title="发送文件">
                    <i class="layui-icon layim-tool-image"></i>
                </span>
                <span title="发送网络音频">
                    <i class="layui-icon layui-icon-headset"></i>
                </span>
                <span title="发送网络视频">
                    <i class="layui-icon layui-icon-video"></i>
                </span>
                <span>
                    <i class="layui-icon layui-icon-log"></i>
                    <span>聊天记录</span>
                </span>
            </div>
            <div class="talk-text">
                <textarea></textarea>
            </div>
            <div class="talk-op">
                <div class="talk-btns">
                    <span class="talk-btns-close">关闭</span>
                    <span class="talk-btns-send">发送</span>
                </div>
            </div>
        </div>
        <div class="talk-right">
            <div>群成员 <span></span></div>
            <ul></ul>
        </div>
    </div>
    <!--右下角图标-->
    <div id="userwin-min">
        <i class="layui-icon layui-icon-login-qq" title="打开主窗口"></i>
    </div>
    <!--查找好友窗口-->
    <div class="userfind">
        <div class="talk-header">
            <div class="userfind-title">
                查找好友
            </div>
            <div class="talk-win-handle">
                <a href="javascript:void(0)" class="icon-min" title="最小化"><cite></cite></a>
                <a href="javascript:void(0)" class="icon-max" title="最大化"></a>
                <a href="javascript:void(0)" class="icon-close" title="关闭"></a>
            </div>
            <div class="userfind-dest">
                <div data-kind="user" class="active">找人</div>
                <div data-kind="group">找群</div>
            </div>
        </div>
        <div class="userfind-user">
            <div class="userfind-filter">
                <div>
                    <input id="userfindText" placeholder="请输入用户账号或昵称..." />
                </div>
                <div>
                    <button class="layui-btn layui-btn-normal" style="margin:10px;" id="userfindSearch">搜索</button>
                </div>
            </div>
            <div class="userfind-result">
                <ul>
                    <li>
                        <img src="img/user1.png" />
                        <span>闲心</span>
                        <button class="layui-btn layui-btn-xs">添加</button>
                    </li>
                </ul>
            </div>
        </div>
    </div>
    <!--消息盒子-->
    <div class="msgbox" style="display:none;">
        <div class="talk-header">
            <div class="userfind-title">
                消息盒子
            </div>
            <div class="talk-win-handle">
                <a href="javascript:void(0)" class="icon-min" title="最小化"><cite></cite></a>
                <a href="javascript:void(0)" class="icon-max" title="最大化"></a>
                <a href="javascript:void(0)" class="icon-close" title="关闭"></a>
            </div>
        </div>
        <div class="msg-container">
            <ul>
                <li>
                    <a href="#">
                        <img src="img/user1.png" />
                    </a>
                    <p class="msg-text">
                        <span>测试用户1</span>
                        <span>2018-12-26</span>
                    </p>
                    <p class="msg-text">
                        <span>申请添加你为好友</span>
                        <span>附言:有问题要请教</span>
                    </p>
                    <p class="msg-btns">
                        <button class="layui-btn layui-btn-small">同意</button>
                        <button class="layui-btn layui-btn-small layui-btn-primary">拒绝</button>
                    </p>
                </li>
                <li>
                    <a href="#">
                        <img src="img/user1.png" />
                    </a>
                    <p class="msg-text">
                        <span>测试用户1</span>
                        <span>2018-12-26</span>
                    </p>
                    <p class="msg-text">
                        <span>申请添加你为好友</span>
                        <span>附言:有问题要请教</span>
                    </p>
                    <p class="msg-btns">
                        <button class="layui-btn layui-btn-small">同意</button>
                        <button class="layui-btn layui-btn-small layui-btn-primary">拒绝</button>
                    </p>
                </li>
            </ul>
        </div>
    </div>
    <script>
        function _para(key) {
            var search = window.location.search || "";
            if (search.indexOf("?") >= 0) {
                var arr = search.split("&");
                for (var i = 0; i < arr.length; i++) {
                    var name = arr[i].split("=")[0];
                    if (name = key) {
                        return arr[i].split("=")[1];;
                    }
                }
            }
        }

        var layer = layui.layer;
        function login() {
            var username = $.trim($("#username").val());
            var password = $.trim($("#password").val());
            if (username == "" || password == "") {
                layer.alert("请输入用户名和密码!");
                return;
            }
            chat.login(username, password);
        }

        function toggleTab(item) {
            $(".win-tabs i").removeClass("active");
            $(item).find("i").addClass("active");
            var kind = $(item).attr("data-kind");
            $(".win-content>div").hide();
            if (kind == "user") {
                $("#tabUser").show();
            } else if (kind == "group") {
                $("#tabGroup").show();
            } else if (kind == "history") {
                $("#tabHistory").show();
            }
        }

        $(function () {
            //$("#login").hide();
            //$(".talk-win").show();
            $("#username").keydown(function (evt) {
                if (evt.keyCode == 13) {
                    $("#password").focus();
                }
            });
            $("#password").keydown(function (evt) {
                if (evt.keyCode == 13) {
                    login();
                }
            });
            var loginuser = _para("user");
            if (loginuser) {
                $("#username").val(loginuser);
                $("#password").val("");
            }
            //注册窗口拖动事件
            $("#userwin .win-title").mousedown(function (evt) {
                var dialog = $("#userwin");
                var startx = evt.pageX;
                var starty = evt.pageY;
                var moveFunc = function (evt) {
                    var startx2 = evt.pageX;
                    var starty2 = evt.pageY;
                    var dx = startx2 - startx;
                    var dy = starty2 - starty;
                    var bottom = parseInt(dialog.css("bottom")) - dy
                    var right = parseInt(dialog.css("right")) - dx;
                    startx = startx2;
                    starty = starty2;
                    if (bottom < 0 || right < 0) {
                        //防止对话框移出
                        return;
                    }
                    dialog.css({
                        "bottom": bottom,
                        "right": right
                    })
                }
                var upFunc = function () {
                    $(document).off('mousemove', moveFunc).off('mouseup', upFunc);
                }
                $(document).mousemove(moveFunc);
                $(document).mouseup(upFunc);
            });
            //注册窗口关闭(隐藏)事件
            $("#userwin>.win-header>.win-close").click(function () {
                var win = $("#userwin");
                var winmin = $("#userwin-min");
                win.hide();
                winmin.show();
            });
            //注册右下角点击事件
            $("#userwin-min").click(function () {
                var win = $("#userwin");
                var winmin = $("#userwin-min");
                win.show();
                winmin.hide();
            });
        });
    </script>
</body>
</html>